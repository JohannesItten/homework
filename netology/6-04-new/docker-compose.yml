services:
  prometheus:
    extends:
      file: docker-compose.prometheus.yml
      service: prometheus
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget --spider --timeout=5 http://localhost:9090/-/healthy || exit 1",
        ]
      interval: 10s
      timeout: 5s
      retries: 3

  pushgateway:
    extends:
      file: docker-compose.pushgateway.yml
      service: pushgateway
    depends_on:
      prometheus:
        condition: service_healthy
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget --spider --timeout=5 http://localhost:9091/-/healthy || exit 1",
        ]
      interval: 10s
      timeout: 5s
      retries: 3

  grafana:
    extends:
      file: docker-compose.grafana.yml
      service: grafana
    depends_on:
      prometheus:
        condition: service_healthy
      pushgateway:
        condition: service_healthy

  alertmanager:
    extends:
      file: docker-compose.alertmanager.yml
      service: alertmanager
    depends_on:
      prometheus:
        condition: service_healthy

volumes:
  prom-data:
  grafana-data:
  alertmanager-data:

networks:
  sergeev-di-my-netology-hw:
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.0.0/16
          gateway: 10.10.0.11
